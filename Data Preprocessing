
## Data Preprocessing Workflow
-- Drop the table if it already exists to avoid conflicts
DROP TABLE IF EXISTS cleaned_netflix;

-- Create a cleaned version of the Netflix dataset
CREATE TABLE cleaned_netflix AS
SELECT
    show_id,
    title,
    -- Keep missing directors and cast entries, replacing NULLs with 'Unknown'
    COALESCE(director, 'Unknown') AS director,
    COALESCE(cast, 'Unknown') AS cast,
    COALESCE(country, 'Unknown') AS country,

    -- Convert date_added to ISO format (YYYY-MM-DD)
    CASE
        WHEN date_added IS NOT NULL THEN STRFTIME('%Y-%m-%d', date_added)
        ELSE NULL
    END AS date_added,

    release_year,

    -- Retain rating for classification analysis
    rating,

    duration,

    -- Extract numeric portion of duration (in minutes or seasons)
    CASE
        WHEN duration LIKE '% min' THEN CAST(SUBSTR(duration, 1, INSTR(duration, ' ') - 1) AS INT)
        WHEN duration LIKE '% Season%' THEN CAST(SUBSTR(duration, 1, INSTR(duration, ' ') - 1) AS INT)
        ELSE NULL
    END AS duration_num,

    listed_in,
    description,

    -- Replace NULL type values with the dataset's mode (most frequent type)
    (
        SELECT mode_type
        FROM (
            SELECT type AS mode_type,
                   COUNT(*) AS cnt
            FROM raw_netflix
            GROUP BY type
            ORDER BY cnt DESC
            LIMIT 1
        )
    ) AS type FROM raw_netflix
-- Remove rows where critical fields are missing
WHERE rating IS NOT NULL
  AND date_added IS NOT NULL;


